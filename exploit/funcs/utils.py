import os, re

RBXPath = os.getenv("LOCALAPPDATA") + "\\Roblox\\logs"
RENDER_VIEW_PATTERN = r"SurfaceController\[_:1\]::initialize view\((.*?)\)"

# version-eadc3c90bb1a4267
class Offsets:
    DataModelHolder = 0x118
    DataModel = 0x198
    module_iscore = 0x198
    Name = 0x50
    Children = 0x58
    Parent = 0x28
    ClassDescriptor = 0x18
    ValueBase = 0xC0
    ModuleFlags = 0x198
    BytecodeSize = 0xA8
    Bytecode = {
        "LocalScript": 0x1B8,
        "ModuleScript": 0x160
    }
Capabilities = { # u should add 0x69: "NiggaSixtyNine" !!!
    0x0: "None",
    0x1: "Plugin",
    0x2: "LocalUser",
    0x4: "WritePlayer",
    0x8: "RobloxScriptSecurity",
    0x10: "RobloxEngine",
    0x20: "NotAccessible"
}

RBXPath = os.getenv("LOCALAPPDATA") + "\\Roblox\\logs"

def find_latest_modified_file(directory):
    if not os.path.isdir(directory):
        raise ValueError(f"{directory} folder not found looser")

    files = [os.path.join(directory, file) for file in os.listdir(directory)]

    files = [file for file in files if os.path.isfile(file)]

    if not files:
        return None

    latest_file = max(files, key=os.path.getmtime)

    return latest_file

def extract_data_from_file(file_path, pattern):
    with open(file_path, 'r', encoding='utf-8') as file:
        content = file.read()
    
    file.close()

    matches = re.findall(pattern, content)
    return matches

def GetRenderViewFromLog():
    latest_file = find_latest_modified_file(RBXPath)
    if latest_file:
        try:
            pattern = r"SurfaceController\[_:1\]::initialize view\((.*?)\)"
            matches = extract_data_from_file(latest_file, pattern)
            if matches:
                for match in matches:
                    RenderView = int(match, 16)
                    return RenderView
        except FileNotFoundError:
            return 0
        except Exception as e:
            return 0
